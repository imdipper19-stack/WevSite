
// ==========================================
// Support Tickets
// ==========================================

enum TicketStatus {
  OPEN
  IN_PROGRESS
  CLOSED
  RESOLVED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model Ticket {
  id              String         @id @default(uuid())
  subject         String
  authorId        String         @map("author_id")
  author          User           @relation(fields: [authorId], references: [id])
  
  status          TicketStatus   @default(OPEN)
  priority        TicketPriority @default(MEDIUM)
  
  messages        TicketMessage[]
  
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  
  @@index([authorId])
  @@index([status])
  @@map("tickets")
}

model TicketMessage {
  id              String    @id @default(uuid())
  ticketId        String    @map("ticket_id")
  ticket          Ticket    @relation(fields: [ticketId], references: [id], onDelete: Cascade)
  
  senderId        String    @map("sender_id")
  sender          User      @relation(fields: [senderId], references: [id])
  
  content         String
  isInternal      Boolean   @default(false) @map("is_internal") // For admin notes
  
  createdAt       DateTime  @default(now()) @map("created_at")
  
  @@index([ticketId])
  @@index([senderId])
  @@map("ticket_messages")
}
